# ternent-api environment example
# Copy to .ops/ternent-api/.env (or your deployment secret source) and fill values.

# -------------------------------------------------------------------
# Core / issuer
# -------------------------------------------------------------------
NODE_ENV=production
DIGITALOCEAN_TOKEN=<optional_digitalocean_token>

ISSUER_PRIVATE_KEY_PEM="-----BEGIN PRIVATE KEY-----\n<pkcs8-private-key>\n-----END PRIVATE KEY-----\n"
ISSUER_MASTER_SEED=<64_hex_or_strong_seed_for_weekly_packs>

# Optional override. If not set, derived from ISSUER_PRIVATE_KEY_PEM public key.
ISSUER_KEY_ID=<optional_issuer_key_id_sha256_of_public_key_pem>

# -------------------------------------------------------------------
# Ledger (required for issuance receipts)
# -------------------------------------------------------------------
LEDGER_S3_ENDPOINT=https://lon1.digitaloceanspaces.com
LEDGER_BUCKET=<spaces_bucket_name>
LEDGER_PREFIX=pixpax/ledger
LEDGER_REGION=lon1
LEDGER_ACCESS_KEY_ID=<spaces_access_key_id>
LEDGER_SECRET_ACCESS_KEY=<spaces_secret_access_key>

# Optional ledger tuning
LEDGER_FLUSH_MAX_EVENTS=200
LEDGER_FLUSH_INTERVAL_MS=60000
LEDGER_FLUSH_SYNC_ON_ISSUE=true
LEDGER_RECORD_DEV_ISSUES=false
LEDGER_S3_FORCE_PATH_STYLE=true

# Optional trusted key set for receipt verification.
# Must be JSON array string of { keyId, publicKeyPem }.
LEDGER_TRUSTED_ISSUER_PUBLIC_KEYS_JSON='[]'

# -------------------------------------------------------------------
# PixPax curated album content/admin
# -------------------------------------------------------------------
# Prefix for curated collection JSON artifacts.
LEDGER_CONTENT_PREFIX=pixpax/collections

# Optional dedicated content bucket. If omitted, falls back to LEDGER_BUCKET.
# LEDGER_CONTENT_BUCKET=<optional_content_bucket_name>

# Required for admin upload endpoints:
# PUT /v1/pixpax/collections/:collectionId/:version/collection
# PUT /v1/pixpax/collections/:collectionId/:version/index
# PUT /v1/pixpax/collections/:collectionId/:version/cards/:cardId
PIX_PAX_ADMIN_TOKEN=<long_random_admin_token>

# Required to mint/verify one-time override codes:
# POST /v1/pixpax/collections/:collectionId/:version/override-codes
# POST /v1/pixpax/collections/:collectionId/:version/packs (with overrideCode)
PIX_PAX_OVERRIDE_CODE_SECRET=<long_random_hmac_secret>

# -------------------------------------------------------------------
# Platform auth/account (Better Auth + Postgres)
# -------------------------------------------------------------------
DATABASE_URL=postgresql://ternent:change-me@ternent-postgres.backend.svc.cluster.local:5432/ternent
DATABASE_SSL=false
DATABASE_POOL_MAX=10
DATABASE_IDLE_TIMEOUT_MS=30000
DATABASE_CONNECT_TIMEOUT_MS=5000

# Auth base URL should be your public API host.
AUTH_BASE_URL=https://api.ternent.dev
AUTH_SECRET=<long_random_auth_secret>
AUTH_TRUSTED_ORIGINS=https://concord.ternent.dev
CORS_ALLOW_ORIGINS=https://concord.ternent.dev

# Session tuning
AUTH_SESSION_IDLE_SECONDS=604800
AUTH_SESSION_ROLLING_SECONDS=1800
AUTH_EMAIL_OTP_EXPIRY_SECONDS=300

# Email OTP fallback (optional but recommended)
SMTP_HOST=<smtp_host>
SMTP_PORT=587
SMTP_SECURE=false
SMTP_USER=<smtp_user>
SMTP_PASS=<smtp_password>
SMTP_FROM=noreply@ternent.dev

# -------------------------------------------------------------------
# Optional public key vars (useful for tooling/frontends)
# -------------------------------------------------------------------
ISSUER_PUBLIC_KEY_PEM="-----BEGIN PUBLIC KEY-----\n<spki-public-key>\n-----END PUBLIC KEY-----\n"
VITE_ISSUER_PUBLIC_KEY_PEM="-----BEGIN PUBLIC KEY-----\n<spki-public-key>\n-----END PUBLIC KEY-----\n"
