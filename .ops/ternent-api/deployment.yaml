apiVersion: apps/v1
kind: Deployment
metadata:
  name: ternent-api
  namespace: backend
spec:
  replicas: 1
  selector:
    matchLabels:
      app: ternent-api
  template:
    metadata:
      labels:
        app: ternent-api
    spec:
      containers:
        - name: ternent-api
          image: samternent/ternent-api:latest
          imagePullPolicy: Always
          ports:
            - name: http
              containerPort: 3000
          env:
            - name: DIGITALOCEAN_TOKEN
              valueFrom:
                secretKeyRef:
                  name: ternent-api-env
                  key: digitalocean-token
            - name: ISSUER_PRIVATE_KEY_PEM
              valueFrom:
                secretKeyRef:
                  name: ternent-api-env
                  key: issuer-private-key-pem
            - name: PIX_PAX_RECEIPT_PRIVATE_KEY_PEM
              valueFrom:
                secretKeyRef:
                  name: ternent-api-env
                  key: pix-pax-receipt-private-key-pem
            - name: PIX_PAX_RECEIPT_PUBLIC_KEY_PEM
              valueFrom:
                secretKeyRef:
                  name: ternent-api-env
                  key: pix-pax-receipt-public-key-pem
                  optional: true
            - name: PIX_PAX_RECEIPT_KEY_ID
              valueFrom:
                secretKeyRef:
                  name: ternent-api-env
                  key: pix-pax-receipt-key-id
                  optional: true
            - name: ISSUER_MASTER_SEED
              valueFrom:
                secretKeyRef:
                  name: ternent-api-env
                  key: issuer-master-seed
            - name: ISSUER_KEY_ID
              valueFrom:
                secretKeyRef:
                  name: ternent-api-ledger
                  key: issuer-key-id
                  optional: true
            - name: LEDGER_S3_ENDPOINT
              valueFrom:
                secretKeyRef:
                  name: ternent-api-ledger
                  key: ledger-s3-endpoint
            - name: LEDGER_BUCKET
              valueFrom:
                secretKeyRef:
                  name: ternent-api-ledger
                  key: ledger-bucket
            - name: LEDGER_PREFIX
              valueFrom:
                secretKeyRef:
                  name: ternent-api-ledger
                  key: ledger-prefix
            - name: LEDGER_ACCESS_KEY_ID
              valueFrom:
                secretKeyRef:
                  name: ternent-api-ledger
                  key: ledger-access-key-id
            - name: LEDGER_SECRET_ACCESS_KEY
              valueFrom:
                secretKeyRef:
                  name: ternent-api-ledger
                  key: ledger-secret-access-key
            - name: LEDGER_REGION
              valueFrom:
                secretKeyRef:
                  name: ternent-api-ledger
                  key: ledger-region
            - name: LEDGER_FLUSH_MAX_EVENTS
              valueFrom:
                secretKeyRef:
                  name: ternent-api-ledger
                  key: ledger-flush-max-events
                  optional: true
            - name: LEDGER_FLUSH_INTERVAL_MS
              valueFrom:
                secretKeyRef:
                  name: ternent-api-ledger
                  key: ledger-flush-interval-ms
                  optional: true
            - name: LEDGER_FLUSH_SYNC_ON_ISSUE
              value: "true"
            - name: LEDGER_RECORD_DEV_ISSUES
              valueFrom:
                secretKeyRef:
                  name: ternent-api-ledger
                  key: ledger-record-dev-issues
                  optional: true
            - name: LEDGER_TRUSTED_ISSUER_PUBLIC_KEYS_JSON
              valueFrom:
                secretKeyRef:
                  name: ternent-api-ledger
                  key: ledger-trusted-issuer-public-keys-json
                  optional: true
            - name: PIX_PAX_OVERRIDE_CODE_SECRET
              valueFrom:
                secretKeyRef:
                  name: ternent-api-pixpax-content
                  key: pix-pax-override-code-secret
                  optional: true
            - name: PIX_PAX_ADMIN_TOKEN
              valueFrom:
                secretKeyRef:
                  name: ternent-api-pixpax-content
                  key: pix-pax-admin-token
            - name: LEDGER_CONTENT_PREFIX
              valueFrom:
                secretKeyRef:
                  name: ternent-api-pixpax-content
                  key: ledger-content-prefix
            - name: LEDGER_CONTENT_BUCKET
              valueFrom:
                secretKeyRef:
                  name: ternent-api-pixpax-content
                  key: ledger-content-bucket
                  optional: true
            - name: DATABASE_URL
              valueFrom:
                secretKeyRef:
                  name: ternent-api-auth
                  key: database-url
            - name: DATABASE_SSL
              valueFrom:
                secretKeyRef:
                  name: ternent-api-auth
                  key: database-ssl
                  optional: true
            - name: AUTH_SECRET
              valueFrom:
                secretKeyRef:
                  name: ternent-api-auth
                  key: auth-secret
            - name: AUTH_BASE_URL
              value: "https://api.ternent.dev"
            - name: AUTH_TRUSTED_ORIGINS
              valueFrom:
                secretKeyRef:
                  name: ternent-api-auth
                  key: auth-trusted-origins
                  optional: true
            - name: AUTH_PASSKEY_RP_ID
              valueFrom:
                secretKeyRef:
                  name: ternent-api-auth
                  key: auth-passkey-rp-id
                  optional: true
            - name: AUTH_PASSKEY_RP_NAME
              valueFrom:
                secretKeyRef:
                  name: ternent-api-auth
                  key: auth-passkey-rp-name
                  optional: true
            - name: AUTH_PASSKEY_ORIGINS
              valueFrom:
                secretKeyRef:
                  name: ternent-api-auth
                  key: auth-passkey-origins
                  optional: true
            - name: AUTH_SESSION_IDLE_SECONDS
              valueFrom:
                secretKeyRef:
                  name: ternent-api-auth
                  key: auth-session-idle-seconds
                  optional: true
            - name: AUTH_SESSION_ROLLING_SECONDS
              valueFrom:
                secretKeyRef:
                  name: ternent-api-auth
                  key: auth-session-rolling-seconds
                  optional: true
            - name: RESEND_API_KEY
              valueFrom:
                secretKeyRef:
                  name: ternent-api-auth
                  key: resend-api-key
                  optional: true
            - name: RESEND_FROM
              valueFrom:
                secretKeyRef:
                  name: ternent-api-auth
                  key: resend-from
                  optional: true
            - name: RESEND_REPLY_TO
              valueFrom:
                secretKeyRef:
                  name: ternent-api-auth
                  key: resend-reply-to
                  optional: true
            - name: RESEND_API_BASE
              valueFrom:
                secretKeyRef:
                  name: ternent-api-auth
                  key: resend-api-base
                  optional: true
            - name: SMTP_HOST
              valueFrom:
                secretKeyRef:
                  name: ternent-api-auth
                  key: smtp-host
                  optional: true
            - name: SMTP_PORT
              valueFrom:
                secretKeyRef:
                  name: ternent-api-auth
                  key: smtp-port
                  optional: true
            - name: SMTP_SECURE
              valueFrom:
                secretKeyRef:
                  name: ternent-api-auth
                  key: smtp-secure
                  optional: true
            - name: SMTP_USER
              valueFrom:
                secretKeyRef:
                  name: ternent-api-auth
                  key: smtp-user
                  optional: true
            - name: SMTP_PASS
              valueFrom:
                secretKeyRef:
                  name: ternent-api-auth
                  key: smtp-pass
                  optional: true
            - name: SMTP_FROM
              valueFrom:
                secretKeyRef:
                  name: ternent-api-auth
                  key: smtp-from
                  optional: true
            - name: CORS_ALLOW_ORIGINS
              valueFrom:
                secretKeyRef:
                  name: ternent-api-auth
                  key: cors-allow-origins
                  optional: true
  
